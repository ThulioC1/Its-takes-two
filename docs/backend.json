{
  "entities": {
    "ToDoItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ToDoItem",
      "type": "object",
      "description": "Represents a to-do item in the shared list.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the to-do item."
        },
        "title": {
          "type": "string",
          "description": "Title of the to-do item."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the to-do item."
        },
        "status": {
          "type": "string",
          "description": "Current status of the to-do item (e.g., 'to do', 'in progress', 'completed')."
        },
        "creationDate": {
          "type": "string",
          "description": "Date when the to-do item was created.",
          "format": "date-time"
        },
        "completionDate": {
          "type": "string",
          "description": "Date when the to-do item was completed (if applicable).",
          "format": "date-time"
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "title",
        "status",
        "creationDate",
        "author"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a shared expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense."
        },
        "value": {
          "type": "number",
          "description": "Monetary value of the expense."
        },
        "category": {
          "type": "string",
          "description": "Category of the expense (e.g., 'Groceries', 'Entertainment')."
        },
        "payer": {
          "type": "string",
          "description": "Identifier of the user who paid the expense. (Relationship: User 1:N Expense)"
        },
        "date": {
          "type": "string",
          "description": "Date when the expense was incurred.",
          "format": "date-time"
        },
        "observation": {
          "type": "string",
          "description": "Optional notes or observations about the expense."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "value",
        "category",
        "payer",
        "date",
        "author"
      ]
    },
    "MovieSeries": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MovieSeries",
      "type": "object",
      "description": "Represents a movie or series in the shared list.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the movie or series."
        },
        "name": {
          "type": "string",
          "description": "Title of the movie or series."
        },
        "type": {
          "type": "string",
          "description": "Type of media (e.g., 'Movie', 'Series')."
        },
        "platform": {
          "type": "string",
          "description": "Platform where the movie or series can be watched (e.g., 'Netflix', 'Hulu')."
        },
        "link": {
          "type": "string",
          "description": "Optional link to the movie or series.",
          "format": "uri"
        },
        "status": {
          "type": "string",
          "description": "Current status of watching the movie or series (e.g., 'To Watch', 'Watching', 'Watched')."
        },
        "dateWatched": {
          "type": "string",
          "description": "Date when the movie or series was watched.",
          "format": "date-time"
        },
        "season": {
          "type": "number",
          "description": "The current season number for a series."
        },
        "episode": {
          "type": "number",
          "description": "The current episode number for a series."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "name",
        "type",
        "status",
        "author"
      ]
    },
    "ImportantDate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ImportantDate",
      "type": "object",
      "description": "Represents an important date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the important date."
        },
        "title": {
          "type": "string",
          "description": "Title of the important date (e.g., 'Anniversary', 'Birthday')."
        },
        "date": {
          "type": "string",
          "description": "Date of the important event.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of important date (e.g., 'Anniversary', 'Birthday')."
        },
        "observation": {
          "type": "string",
          "description": "Optional notes or observations about the important date."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "title",
        "date",
        "type",
        "author"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a post on the couple's wall.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post."
        },
        "text": {
          "type": "string",
          "description": "Text content of the post."
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time when the post was created.",
          "format": "date-time"
        },
        "likes": {
          "type": "array",
          "description": "References to Users who liked this post. (Relationship: User N:N Post)",
          "items": {
            "type": "string"
          }
        },
        "comments": {
          "type": "number",
          "description": "Count of comments on the post."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "text",
        "dateTime",
        "author"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment."
        },
        "postId": {
          "type": "string",
          "description": "Reference to Post. (Relationship: Post 1:N Comment)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "Text content of the comment."
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "userId",
        "text",
        "dateTime"
      ]
    },
    "Memory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Memory",
      "type": "object",
      "description": "Represents a shared photo in the memories album.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the memory."
        },
        "image": {
          "type": "string",
          "description": "URL or path to the image stored in Firebase Storage."
        },
        "description": {
          "type": "string",
          "description": "Description of the memory."
        },
        "date": {
          "type": "string",
          "description": "Date when the memory was created or captured.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "Optional location where the memory was captured."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "image",
        "description",
        "date",
        "author"
      ]
    },
    "LoveLetter": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoveLetter",
      "type": "object",
      "description": "Represents a private message between the couple.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the love letter."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User who sent the love letter. (Relationship: User 1:N LoveLetter (sent))"
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to User who is the recipient of the love letter. (Relationship: User 1:N LoveLetter (received))"
        },
        "message": {
          "type": "string",
          "description": "Text content of the love letter."
        },
        "scheduledDate": {
          "type": "string",
          "description": "Date and time when the message should become visible.",
          "format": "date-time"
        },
        "isVisible": {
          "type": "boolean",
          "description": "Indicates whether the message is visible to the recipient."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "message",
        "scheduledDate",
        "isVisible",
        "author"
      ]
    },
    "CoupleGoal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CoupleGoal",
      "type": "object",
      "description": "Represents a shared goal for the couple.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the couple goal."
        },
        "title": {
          "type": "string",
          "description": "Title of the couple goal."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the couple goal."
        },
        "progress": {
          "type": "number",
          "description": "Current progress towards the goal (percentage).",
          "format": "number"
        },
        "status": {
          "type": "string",
          "description": "Current status of the goal (e.g., 'In Progress', 'Completed')."
        },
        "type": {
          "type": "string",
          "description": "Type of goal (e.g., 'Financial', 'Personal', 'Relationship')."
        },
        "author": {
          "$ref": "#/entities/Author"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "progress",
        "status",
        "type",
        "author"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the user, from Firebase Auth."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "coupleId": {
          "type": "string",
          "description": "Identifier for the couple this user belongs to."
        }
      },
      "required": [
        "uid",
        "email",
        "coupleId"
      ]
    },
    "Author": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Author",
      "type": "object",
      "description": "Represents the user who created a document.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID from Firebase Authentication."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        }
      },
      "required": [
        "uid",
        "displayName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/entities/User"
          },
          "description": "Stores user profile information, including their couple ID.",
          "params": [
            {
              "name": "userId",
              "description": "The user's unique ID from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/entities/User"
          },
          "description": "Represents a couple. All couple related data is stored under this document.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/todos/{todoId}",
        "definition": {
          "entityName": "ToDoItem",
          "schema": {
            "$ref": "#/entities/ToDoItem"
          },
          "description": "Represents a to-do item for the couple.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "todoId",
              "description": "Unique identifier for the to-do item."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/entities/Expense"
          },
          "description": "Represents an expense for the couple.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/movies/{movieId}",
        "definition": {
          "entityName": "MovieSeries",
          "schema": {
            "$ref": "#/entities/MovieSeries"
          },
          "description": "Represents a movie or series in the shared list.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "movieId",
              "description": "Unique identifier for the movie or series."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/dates/{dateId}",
        "definition": {
          "entityName": "ImportantDate",
          "schema": {
            "$ref": "#/entities/ImportantDate"
          },
          "description": "Represents an important date for the couple.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "dateId",
              "description": "Unique identifier for the important date."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/entities/Post"
          },
          "description": "Represents a post on the couple's wall.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "postId",
              "description": "Unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/posts/{postId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/entities/Comment"
          },
          "description": "Represents a comment on a post.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "postId",
              "description": "Unique identifier for the post."
            },
            {
              "name": "commentId",
              "description": "Unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/memories/{memoryId}",
        "definition": {
          "entityName": "Memory",
          "schema": {
            "$ref": "#/entities/Memory"
          },
          "description": "Represents a shared photo in the memories album.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "memoryId",
              "description": "Unique identifier for the memory."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/loveLetters/{loveLetterId}",
        "definition": {
          "entityName": "LoveLetter",
          "schema": {
            "$ref": "#/entities/LoveLetter"
          },
          "description": "Represents a private message between the couple.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "loveLetterId",
              "description": "Unique identifier for the love letter."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/goals/{goalId}",
        "definition": {
          "entityName": "CoupleGoal",
          "schema": {
            "$ref": "#/entities/CoupleGoal"
          },
          "description": "Represents a shared goal for the couple.",
          "params": [
            {
              "name": "coupleId",
              "description": "Unique identifier for the couple."
            },
            {
              "name": "goalId",
              "description": "Unique identifier for the couple goal."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data isolation and efficient querying for the \"Its take two\" application. All data is scoped under a `couples` collection, where each document represents a couple and is identified by a unique ID. This top-level segregation facilitates managing data access and ensures that data belonging to different couples is kept separate. The use of subcollections for each feature (to-do items, expenses, movies/series, etc.) allows for specific security rules and efficient data retrieval.\n\n**Authorization Independence and Security:**\nTo achieve Authorization Independence, the design leverages path-based ownership. Each couple's data is stored under `/couples/{coupleId}`, eliminating the need for `get()` calls in security rules. This ensures that authorization can be determined solely based on the path and the user's authentication state, without relying on parent document data. This approach enhances the robustness of transactions and batch operations.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations (QAPs) by adhering to Structural Segregation. Each collection houses documents with similar access requirements. For example, only members of a couple should have access to their shared to-do list or financial data. This homogeneity simplifies security rules and prevents the need to filter data based on access rights within the rules themselves.\n\nThe membership of users in a 'couple' is implicitly derived from the `coupleId` path. To allow a user to access the data associated with a given `coupleId`, their `uid` must be associated with that `coupleId` via a separate mechanism (e.g., a user profile document that contains the `coupleId` or custom claims). The security rules will then enforce that `request.auth.uid` is authorized for the `coupleId` specified in the path.\n\nThis design minimizes complexity in security rules, enhances data integrity, and ensures scalability."
  }
}
